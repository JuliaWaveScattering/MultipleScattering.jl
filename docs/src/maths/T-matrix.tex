\documentclass[ 12pt, a4paper]{article}
% Use the option doublespacing or reviewcopy to obtain double line spacing
% \documentclass[doublespacing]{elsart}

\usepackage[utf8]{inputenc}
\usepackage[backend = biber, maxcitenames=2,uniquelist=minyear]{biblatex}

\AtEveryBibitem{\clearfield{number}}
\AtEveryBibitem{\clearfield{doi}}
\AtEveryBibitem{\clearfield{url}}
\AtEveryBibitem{\clearfield{issn}}
\AtEveryBibitem{\clearfield{isbn}}

\addbibresource{references.bib}

\usepackage{color,graphicx,tikz}
\usetikzlibrary{positioning,arrows}
% The amssymb package provides various useful mathematical symbols
\usepackage{mathtools,amssymb,amsmath,mathdots}
\usepackage[mathscr]{eucal} %just for the font \mathscr
\usepackage{setspace}
\usepackage{hyperref}

\usepackage{tikz}

\renewcommand{\vec}[1]{\boldsymbol{#1}}
\renewcommand{\thefootnote}{\fnsymbol{footnote}}

\input{macros}

\begin{document}

\title{Notes on the T-matrix in 2D}
\author{
Artur L. Gower$^{a}$,\\
\footnotesize{$^{a}$ School of Mathematics, University of Manchester, Oxford Road, Manchester, M13 9PL,UK}
}
\date{\today}
\maketitle

\begin{abstract}
Here we show and deduce the T-matrix and multiple scattering for acoustics. The general multiple scattering formulation shown can be adapted for electromagnetism and elasticity.
\end{abstract}

\noindent
{\textit{Keywords:} Multiple scattering, T-matrix, Scattering matrix}

\section{Using a T-matrix}
A T-matrix denotes how one single particle scatters waves~\parencite{ganesh_far-field_2010,ganesh_algorithm_2017}.

For convenience and generality we denote:
\begin{equation}
\begin{aligned}
    & \mathrm u_{n}(k\rv) = \text{outgoing spherical waves},
    \label{eqn:outgoing_waves_and_regular_waves}
    \\
    & \mathrm v_{n}(k\rv)= \text{regular spherical waves},
 \end{aligned}
\end{equation}
where $n$ denotes a multi index which depends on the dimension and if the waves are scalar or vector fields.

Any incident wave and scattered wave\footnote{For the scattered wave we need only use outgoing spherical waves when measuring the field outside of a sphere which completely encompasses the particle.}, centred at the same coordinate axis, can be written as
\begin{align}
  & \ui = \sum_{n} g_n \mathrm v_{n}(k\rv),
  \\
  & \us = \sum_{n=-\infty}^\infty f_n \mathrm u_{n}(k\rv).
\end{align}
The T-matrix is an infinite matrix such that
\begin{equation}
  f_n = \sum_{n'} T_{nn'} g_{n'}.
\end{equation}
Such a matrix $T$ exists when scattering is a linear operation (elastic scattering).


\section{T-matrix 2D acoustics}

We will be following a similar notation as used in \href{a9-ganesh.pdf}{A T-Matrix Reduced Order
Model Software}~\parencite{ganesh_far-field_2010,ganesh_algorithm_2017}.

For 2D acoustics we have that
\begin{align}
  & \mathrm u_{n}(k\rv) = J_{n}(k r) \ee^{\ii n \theta},
  \\
  & \mathrm v_{n}(k\rv)= H_{n}(k r) \ee^{\ii n \theta}.
\end{align}
When truncating up to some order $N$ we would sum over $n = -N, -N +1, \ldots, N-1, N$.

For instance, if $\rho$ and $c$ are the background density and wavespeed, then for a circular scatterer with density $\rho_j$, soundspeed $c_j$ and radius $a_j$, we have that
\begin{equation}
  T_{nm} = - \delta_{nm} \frac{q_j J_m' (k a_j) J_m (k_j a_j) - J_m (k a_j) J_m' (k_j a_j) }{q_j H_m '(k a_j) J_m(k_j a_j) - H_m(k a_j) J_m '(k_j a_j)},
  \label{eqn:circular_t-matrix}
\end{equation}
where $q_j = (\rho_j c_j)/(\rho c)$ and $k_j = \omega/c_j$.

\subsection{Single circular capsule}

\begin{figure}[t]
\centering
  \begin{tikzpicture}[scale=0.6]
  % Outer box
  \draw (-5,-5) -- (5,-5) -- (5,5) -- (-5,5) -- (-5,-5);

  % Concentric circles
  \draw (0,0) circle (2);
  \draw (0,0) circle (3);

  % Line to show a_1
  \draw (-3.02, 0) -- (-0.02,0);
  \draw (-3.02, 0.3) -- (-3.02,-0.3);
  \draw (-0.02, 0.3) -- (-0.02,-0.3);
  \node at (-1.5,-0.3) { $a_1$ };

  % Line to show a_0
  \draw (2.02, 0) -- (0,0);
  \draw (2.02, 0.3) -- (2.02,-0.3);
  \draw (0.02, 0.3) -- (0.02,-0.3);
  \node at (1,-0.3) { $a_0$ };

  \node at (-4,4) { $c,\rho$ };
  \node at (0,1) { $c_0,\rho_0$ };
  \node at (0,2.5) { $c_1,\rho_1$ };

  \end{tikzpicture}

  \label{fig:capsule}
\end{figure}

\begin{align}
  & \psi^0 = \sum_{n=-\infty}^\infty g_n^0 J_{n}(k_0 r) \ee^{\ii n \theta},
  \\
  & \psi^1 = \sum_{n=-\infty}^\infty \left [ g_n^1 J_{n}(k_1 r) + f_n^1 H_{n}(k_1 r) \right ] \ee^{\ii n \theta}.
\end{align}
Applying the boundary conditions,
\begin{align}
  	& \psi^0 = \psi^1 \quad \text{and} \quad \frac{1}{\rho_0} \frac{\partial \psi^0}{\partial r} = \frac{1}{\rho_1} \frac{\partial \psi^1}{\partial r}, \quad \text{on} \;\; r = a_0,
    \label{eqn:inner_bc}
    \\
  	& \psi^1 = \psi^\scat + \psi^\inc \quad \text{and} \quad \frac{1}{\rho_1} \frac{\partial \psi^1}{\partial r} = \frac{1}{\rho} \frac{\partial (\psi^\scat + \psi^\inc)}{\partial r}, \quad \text{on} \;\; r = a_1.
    \label{eqn:outer_bc}
\end{align}
Solving these boundary conditions (see \href{capsule-boundary-conditions.nb}{capsule-boundary-conditions.nb}) leads to
\begin{multline}
  T_{nn} = - \frac{J_n(k a_1)}{H_n(k a_1)} - \frac{Y^n_{'}(k a_1, k a_1)}{H_n(ka_1)} \left[Y^n(k_1 a_1,k_1 a_0) J_n'(k_0 a_0) - q_0 J_n(k_0 a_0) Y^n_{'}(k_1 a_1,k_1 a_0) \right]
  \\ \times \big[
    J_n'(k_0 a_0)(q H_n(k a_1)Y^n_{'}(k_1 a_0,k_1 a_1) + H_n'(k a_1) Y^n(k_1 a_1,k_1 a_0))
    \\
    + q_0 J_n(k_0 a_0)(q H_n(k a_1)Y^n_{''}(k_1 a_1,k_1 a_0) - H_n'(k a_1) Y^n_{'}(k_1 a_1, k_1 a_0))
  \big]^{-1}.
\end{multline}
where $q = \rho c/(\rho_1 c_1)$, $q_0 = \rho_0 c_0/( \rho_1 c_1)$, and
\begin{align}
  & Y^n(x,y) = H_n(x) J_n(y) - H_n(y) J_n(x), \\
  & Y^n_{'}(x,y) = H_n(x) J_n'(y) - H_n'(y) J_n(x), \\
  & Y^n_{''}(x,y) = H_n'(x) J_n'(y) - H_n'(y) J_n'(x).
\end{align}

% Using~\eqref{eqn:inner_bc} we get
% \begin{align}
%   & g_n^0 J_{|n|}(k_0 a_0) = g_n^1 J_{|n|}(k_1 a_0) + a_n^0 H_{|n|}(k_1 a_0),
%   \\ \notag
%   & g_n^1 \left [ \frac{J_{|n|}'(k_0 a_1)}{\rho_0 c_0} \frac{J_{|n|}(k_1 a_0)}{J_{|n|}(k_0 a_0)} - \frac{J_{|n|}'(k_1 a_1)}{\rho_1 c_1} \right ] =
%   a_n^1 \left [ \frac{J_{|n|}'(k_0 a_1)}{\rho_0 c_0} \frac{H_{|n|}(k_1 a_0)}{J_{|n|}(k_0 a_0)} - \frac{H_{|n|}'(k_1 a_1)}{\rho_1 c_1} \right ].
% \end{align}
%
% \begin{gather}
%    g_n^1 J_{|n|}(k_1 a_1) + a_n^1 H_{|n|}(k_1 a_1) =  g_n J_{|n|}(k a_1) + a_n H_{|n|}(k a_1)
%    \\
%    g_n^1 \frac{1}{\rho_1 c_1} J_{|n|}'(k_1 a_1) + a_n^1 \frac{1}{\rho_1 c_1} H_{|n|}'(k_1 a_1)
%    =  g_n \frac{1}{\rho c} J_{|n|}'(k a_1) + a_n \frac{1}{\rho c} H_{|n|}'(k a_1)
% \end{gather}

\section{Multiple scattering in 2D}

Graf's addition theorem in two spatial dimensions:
\begin{align}
  & H_n(k R_\ell)\ee^{\ii n \Theta_\ell} =
  \sum_{m=-\infty}^\infty H_{n-m}(k R_{\ell j})\ee^{\ii(n-m)\Theta_{\ell j}} J_{m}(k R_j)\ee^{\ii m \Theta_j}, \;\;\text{for}\;\; R_j < R_{\ell j},
\label{eqn:Graf}
\end{align}
where $(R_{\ell j},\Theta_{\ell j})$ are the polar coordinates of $\vec r_j - \vec r_\ell$. The above is also valid if we swap $H_n$  for $J_n$, and swap $H_{n-m}$ for $J_{n-m}$.

Particle-$j$ scatters a field
\begin{equation}
  \label{eqn:outwaves}
  u_j = \sum_{n} f_n^j \mathrm u_{n}(k\rv - k \rv_j), \quad \text{for} \;\; |\rv - \rv_j| > a_j,
\end{equation}
% where $(R_j,\Theta_j)$ are the polar coordinates of $\vec r - \vec r_j$,
where $\vec r_j$ is the centre of particle $j$.

Let the incident wave, with coordinate system centred at $\vec r_j$, be
\begin{equation}
  \label{eqn:incident}
  \ui = \sum_{n} g_n^j \mathrm v_{n}(k\rv - k \rv_j),
\end{equation}
then the wave exciting particle-$j$ is
\begin{equation}
  \label{eqn:exciter}
  u_j^E = \sum_{n} F^n_j \mathrm v_{n}(k\rv - k \rv_j)
\end{equation}
where
\begin{equation}
  F_n^j = g_n^j + \sum_{\ell\not = j} \sum_{p=-\infty}^\infty f_p^\ell H_{p-m}(k R_{\ell j})\ee^{\ii(p-m)\Theta_{\ell j}}.
\end{equation}
Using the T-matrix of particle-$j$ we reach $f_n^j = \sum_m T_{nm}^j F_m^j$, which leads to
\begin{equation}
f_q^j  = \sum_{m} T_{qm}^j g_m^j + \sum_{\ell\not = j} \sum_{m,p=-\infty}^\infty f_p^\ell T_{qm}^j H_{p-m}(k R_{\ell j})\ee^{\ii(p-m)\Theta_{\ell j}}.
\label{eqn:As}
\end{equation}
The above simplifies if we substitute $f_q^j =  T_{qd}^j \alpha_d^j$, and then multiple across by $\{T_{qn}^j\}^{-1}$ and sum over $q$ to arrive at
% f_\ell^p = \alpha_\ell^d T^{dp}_\ell
% f_\ell^p = \alpha_\ell^d T^{dp}_\ell
\begin{equation}
\alpha_n^j = g_n^j + \sum_{\ell\not = j} \sum_{m,p=-\infty}^\infty  H_{p-n}(k R_{\ell j})\ee^{\ii(p - n)\Theta_{\ell j}} T_{pm}^\ell \alpha_m^\ell.
\label{eqn:As}
\end{equation}
As a check, if we use~\eqref{eqn:circular_t-matrix}, then we arrive at equation (2.11) in \cite{gower_reflection_2017}.

In the general formulation below we would have
\[
\mathcal U_{n'n}(k R_{\ell j}) = H_{n'-n}(k R_{\ell j})\ee^{\ii(n'-n)\Theta_{\ell j}}.
\]
Note that swapping $\ell$ for $j$ would result in $\Theta_{\ell j} = \Theta_{j \ell } + \pi$.
% \begin{equation}
% f_j^n  = -  f^n_j - \sum_{\ell\not = j} \sum_{p=-\infty}^\infty f_\ell^p Z^p_\ell H_{p-n}(k R_{\ell j})\ee^{\ii(p-n)\Theta_{\ell j}}.
% \end{equation}

\section{Multiple scattering in general}

For multiple scattering in higher dimensions and for vector wave equations we use the notation given in \cite{gower2020effective}.

For a point $\rv$, outside of the circumscribed spheres of all particles, we can write the total field $u(\rv)$ as a sum of the incident wave $\ui(\rv)$ and all scattered waves in the form~\cite{Kristensson2015a,Kristensson2016,Linton+Martin2006}
\begin{equation}
    u(\rv) = \ui(\rv) + \us(\rv), \quad \us(\rv) =  \sum_{i=1}^N \sum_n f_n^i \mathrm u_n (k \rv - k \rv_i),
    \label{eqn:total_discrete_wave}
\end{equation}
where we assumed $ |\rv - \rv_i| > a_i $ for $i=1,2,\ldots N$, the $f_n^i$ are coefficients we need to determine, where again:
\begin{equation}
\left\{\begin{aligned}
    & \mathrm u_{n}(k\rv) = \text{outgoing spherical waves},
    \label{eqn:outgoing_waves_and_regular_waves}
    \\
    & \mathrm v_{n}(k\rv)= \text{regular spherical waves},
 \end{aligned}\right.
\end{equation}
where $n$ denotes a multi index which depends on the dimension and if the waves are scalar or vector fields.

In general, we can write the multiple scattering system in the form:
\begin{equation}\label{eq:Individual-expansion-coefficients}
   \alpha_n^i=g_{n}^i
    +\sum_{\substack{j=1\\j\neq i}}^N \sum_{n' n''}\mathcal{U}_{n''n}(k\rv_i - k\rv_j)T_{n''n'}^j \alpha_{n'}^j,
\end{equation}
for $i=1,2,\ldots,N$, where $f_n^i = \sum_{n'} T^i_{nn'}\alpha_{n'}^i$ and $\mathcal{U}_{nn'}$ is a translation matrix \cite{Bostrom+Kristensson+Strom1991,Friedman+Russek1954}. Let $\rv'=\rv+\dv$, then
the translation matrices for a translation $\dv$ can be defined by the property~\cite{Bostrom+Kristensson+Strom1991}
  \begin{equation}\label{eq:translation_spherical_waves}
 \left\{\begin{aligned}
   &\mathrm{v}_n(k\rv')=\sum_{n'}\mathcal{V}_{nn'}(k\dv)\mathrm{v}_{n'}(k\rv),\quad \text{ for all }\dv
   \\
 &\mathrm{u}_n(k\rv')=\sum_{n'}\mathcal{V}_{nn'}(k\dv)\mathrm{u}_{n'}(k\rv),\quad |\rv|>|\dv|
 \\
   &\mathrm{u}_n(k\rv')=\sum_{n'}\mathcal{U}_{nn'}(k\dv)\mathrm{v}_{n'}(k\rv),\quad |\rv|<|\dv|
   \\
 \end{aligned}\right.
 \end{equation}

\subsection{3D acoustics}

For all the details on acoustics in three spatial dimensions see~\cite{gower2020effective}. Here we all only provide:
\begin{equation}
\left\{\begin{aligned}
    & \mathrm u_{n}(k\rv) = {\mathrm{h}}_\ell^{(1)}(kr)\mathrm{Y}_{n}(\rvh),
    \label{eqn:outgoing_waves_and_regular_waves}
    \\
    & \mathrm v_{n}(k\rv) = \mathrm{j}_\ell(kr)\mathrm{Y}_{n}(\rvh),
 \end{aligned}\right.
\end{equation}
where $r=|\rv|$, $n=\{\ell,m\}$, with summation being over $\ell=0,1,2,3\ldots$ and $m=-\ell,-\ell+1,\ldots,-1,0,1,\ldots,\ell$, and the spherical Hankel and Bessel functions are denoted ${\mathrm{h}}_\ell^{(1)}(z)$ and $\mathrm{j}_\ell(z)$, respectively.

\subsection{Turing equations into code}
For easy implementation we need the functions:
\[
\psi_\inc \mapsto g^m_j \quad \text{and} \quad \text{particle} \mapsto T^{nm}_j.
\]

For efficient implementation we rewrite~\eqref{eqn:As} as a matrix equation. Let
\begin{align}
  &(\vec \alpha_j)_n =  \alpha_n^j, \quad (\vec g_j)_n =  g_n^j,
  \\
  &(\vec T_j)_{nn'} = T_{nn'}^j, \quad (\vec {\mathcal U}_{j \ell})_{nn'} = \mathcal U_{n'n}(k \rv_j - k\rv_\ell),
  % H_{n'-n}(k R_{\ell j})\ee^{\ii(n'-n)\Theta_{\ell j}},
\end{align}

 Then
\begin{equation}
 \sum_{\ell}(\delta_{j \ell} +  (\delta_{j \ell}-1) \vec {\mathcal U}_{j \ell} \vec T_\ell) \vec \alpha_\ell  =  \vec g_j,
\end{equation}
which leads to a block matrix equation:
\begin{equation}
  \begin{bmatrix}
    \vec I & - \vec {\mathcal U}_{1 2}\vec T_2 & \cdots & - \vec {\mathcal U}_{1 (N-1)} \vec T_{N-1} & - \vec {\mathcal U}_{1 N} \vec T_N \\
    - \vec {\mathcal U}_{2 1} \vec T_1 & \vec I &  - \vec {\mathcal U}_{2 3} \vec T_3 & \cdots & - \vec {\mathcal U}_{2 N} \vec T_N \\
     & \vdots & & & \vdots \\
     - \vec {\mathcal U}_{N 1} \vec T_1  & \cdots & \cdots & -  \vec {\mathcal U}_{N (N-1)} \vec T_{N-1} & \vec I
  \end{bmatrix}
  \begin{bmatrix}
    \vec \alpha_1 \\
    \vec \alpha_2 \\
    \vdots \\
    \vec \alpha_N
  \end{bmatrix}
   = \begin{bmatrix}
     \vec g_1 \\
     \vdots \\
     \vec g_N
   \end{bmatrix}
\end{equation}


\printbibliography

\end{document}
